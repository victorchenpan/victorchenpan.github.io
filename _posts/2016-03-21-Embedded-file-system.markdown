## **Linux对文件系统的支持**
虽然嵌入式linux系统不是必须要有文件系统的存在,但实际上基本所有的环境下都配合使用了文件系统,而且如果没有文件系统的存在的话,linux kernel的强大功能无法实现(比如一些文件服务器一般都有大型的磁盘阵列来存放海量的数据等),因此对于文件系统我们必须有一个清楚的总体认识.<br>
kernel和文件系统是两个独立的部分,kernel和文件系统之间通过一个标准的接口来实现,即**用MTD实现VFS虚拟文件系统**,不同的文件结构之间可以通过此接口来交换数据.在linux中,不同的文件系统连接成一个单一的树型结构,用一个统一的单个实体表示文件系统.linux在文件系统安装的时候,把其加载到这个单一的文件系统树上.所有的文件系统,不管什么类型,都安装在一个目录下,安装好的文件系统的文件系统的文件掩盖了这个目录原来存在的内容.这个目录叫作安装目录.当这个文件系统卸载的时候,安装目录自己的文件又可以显现出来.<br>
在嵌入式当中,常用的文件系统有:**EXT2,Cramfs,JFFS,JFFS2,NFS,ramdisk,yaffs,ubifs**,有了文件系统后,接下来的问题是如何将文件系统挂载,文件系统一般都是存放在FALSH中(emmc,norflash,landflash等ROM或磁盘当中),要读取文件系统就必须要有对这些存储设备的驱动程序,kernel当中虽然有这些驱动程序,但如果把这些驱动全都以静态方式编译进内核的话无疑不符合嵌入式系统的实际拥有的极其有限的宝贵资源.所以kernel提供了一种方式:**先通过initrd以及ramdisk来实现挂载root file system**,即先在宿主机在做好ramdisk文件系统的映像并下载到flash中,然后bootloader把它从flash中读取到内存里,通过环境变量参数bootarg来把ramdisk.img在内存的地址以及文件系统类型等这些信息传到kernel中去.kernel启动后会在ram中拿出一块地址用于虚拟成disk,即ramdisk,然后把ramdisk.img复制过来,并且释放之前uboot用来存放ramdisk.img的内存空间.再把ramdisk.img做为root文件系统挂载,动态加载root文件系统里面的驱动程序,并初始化相应的init脚本,最终挂载其它的文件系统.

---
## **各文件系统的介绍**
* JFFS文件系统最早是由瑞典Axis Communications公司基于Linux2.0的内核为嵌入式系统开发的文件系统。JFFS2是RedHat公司基于JFFS开发的闪存文件系统，最初是针对RedHat公司的嵌入式产品eCos开发的嵌入式文件系统，所以JFFS2也可以用在Linux, uCLinux中。

* JFFS22日志闪存文件系统版本2 (Journalling Flash FileSystem v2)

　　主要用于NOR型闪存，基于MTD驱动层，特点是：可读写的、支持数据压缩的、基于哈希表的日志型文件系统，并提供了崩溃/掉电安全保护，提供“写平衡”支持等。缺点主要是当文件系统已满或接近满时，因为垃圾收集的关系而使jffs2的运行速度大大放慢。

　　jffs不适合用于NAND闪存主要是因为NAND闪存的容量一般较大，这样导致jffs为维护日志节点所占用的内存空间迅速增大，另外，jffs文件系统在挂载时需要扫描整个FLASH的内容，以找出所有的日志节点，建立文件结构，对于大容量的NAND闪存会耗费大量时间。


* YAFFS:Yet Another Flash File System

　　yaffs/yaffs2是专为嵌入式系统使用NAND型闪存而设计的一种日志型文件系统。与jffs2相比，它减少了一些功能(例如不支持数据压缩)，所以速度更快，挂载时间很短，对内存的占用较小。另外，它还是跨平台的文件系统，除了Linux和eCos，还支持WinCE, pSOS和ThreadX等。

　　yaffs/yaffs2自带NAND芯片的驱动，并且为嵌入式系统提供了直接访问文件系统的API，用户可以不使用Linux中的MTD与VFS，直接对文件系统操作。当然，yaffs也可与MTD驱动程序配合使用。

yaffs与yaffs2的主要区别在于，前者仅支持小页(512 Bytes) NAND闪存，后者则可支持大页(2KB) NAND闪存。同时，yaffs2在内存空间占用、垃圾回收速度、读/写速度等方面均有大幅提升。

* Cramfs：Compressed ROM File System

　　Cramfs是Linux的创始人 Linus Torvalds参与开发的一种只读的压缩文件系统。它也基于MTD驱动程序。

　　在cramfs文件系统中，每一页(4KB)被单独压缩，可以随机页访问，其压缩比高达2:1,为嵌入式系统节省大量的Flash存储空间，使系统可通过更低容量的FLASH存储相同的文件，从而降低系统成本。

　　Cramfs文件系统以压缩方式存储，在运行时解压缩，所以不支持应用程序以XIP方式运行，所有的应用程序要求被拷到RAM里去运行，但这并不代表比 Ramfs需求的RAM空间要大一点，因为Cramfs是采用分页压缩的方式存放档案，在读取档案时，不会一下子就耗用过多的内存空间，只针对目前实际读取的部分分配内存，尚没有读取的部分不分配内存空间，当我们读取的档案不在内存时，Cramfs文件系统自动计算压缩后的资料所存的位置，再即时解压缩到 RAM中。

　　另外，它的速度快，效率高，其只读的特点有利于保护文件系统免受破坏，提高了系统的可靠性。

　　由于以上特性，Cramfs在嵌入式系统中应用广泛。

　　但是它的只读属性同时又是它的一大缺陷，使得用户无法对其内容对进扩充。

　　Cramfs映像通常是放在Flash中，但是也能放在别的文件系统里，使用loopback 设备可以把它安装别的文件系统里。


* RAMDISK <br> Ramdisk是将一部分固定大小的内存当作分区来使用。它并非一个实际的文件系统，而是一种将实际的文件系统装入内存的机制，并且可以作为根文件系统。将一些经常被访问而又不会更改的文件(如只读的根文件系统)通过Ramdisk放在内存中，可以明显地提高系统的性能。

　　在Linux的启动阶段，initrd提供了一套机制，可以将内核映像和根文件系统一起载入内存。

*  NFS(网络文件系统)<br>
 NFS是由Sun开发并发展起来的一项在不同机器、不同操作系统之间通过网络共享文件的技术。在嵌入式Linux系统的开发调试阶段，可以利用该技术在主机上建立基于NFS的根文件系统，挂载到嵌入式设备，可以很方便地修改根文件系统的内容。
